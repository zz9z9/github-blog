---
title: CDN(Content Delivery Network)
date: 2021-09-11 00:25:00 +0900
categories: [Web 지식]
tags: [CDN]
---

# 들어가기 전
---
얼마전 면접에서 '화면의 초기 로딩 속도가 느리다면 어떻게 해결할 수 있을까요?' 라는 질문에 제대로 대답하지 못했던 기억이 있다.
뒤늦게 생각났는데 CDN을 활용하면 어느정도 개선되지 않을까 하는 생각이 들었다. 하지만, CDN에 대해 어렴풋이 알고있어 얘기를 꺼내지 못했다.
이번 기회에 CDN에 대해 잘 정리해보자.

# CDN이란 ?
---
> Content Delivery Network : 컨텐츠 전송 네트워크

- 정적 컨텐츠를 전송하는데 쓰이는, 지리적으로 분산된 서버의 네트워크이다.
  - html, 이미지, js, 비디오 등과 같은 정적 컨텐츠를 캐싱한다.

- 어떤 사용자가 웹사이트를 방문하면, 그 사용자에게 가장 가까운 CDN 서버가 정적 컨텐츠를 전달한다.

> 다음은 CDN을 활용하는 예를 보여준다.

1. 사용자 A가 이미지 URL을 이용해 image.png에 접근한다.
- URL의 도메인은 CDN 서비스 사업자가 제공한 것이다.
  - 예를 들어 다음 두 URL은 Cloudfront와 Akamai CDN이 제공하는 URL의 예이다.
    - https://mysite.cloudfront.net/logo.png
    - https://mysite.akamai.com/image-manager/img/logo.png

2. CDN 서버의 캐시에 해당 이미지가 없는 경우, 서버는 원본(origin) 서버에 요청하여 파일을 가져온다.
- 원본 서버는 웹 서버일 수도 있고 Amazon S3와 같은 온라인 저장소일 수도 있다.

3. 원본 서버가 파일을 CDN 서버에 반환한다.
- 응답의 HTTP 헤더에는 해당 파일이 얼마나 오래 캐시될 수 있는지를 설명하는 TTL(Time-To-Live)값이 들어있다.

4. CDN 서버는 파일을 캐시하고 사용자 A에게 반환한다.
- 이미지는 TTL에 명시된 시간이 끝날 때까지 캐시된다.

5. 사용자가 B가 같은 이미지에 대한 요청을 CDN 서버에 전송한다.
6. 만료되지 않은 이미지에 대한 요청은 캐시를 통해 처리한다.

<figure align = "center">
  <img src = "https://user-images.githubusercontent.com/64415489/132958378-63e2447d-f68d-450f-9007-030b5cd3b0b3.png" width="70%"/>
  <figcaption align="center">출처 : <a href="https://mygumi.tistory.com/67" target="_blank"> https://mygumi.tistory.com/67</a> </figcaption>
</figure>


# CDN 사용 시 고려해야 할 사항
---
## 1. 비용
CDN은 보통 제 3 사업자(thrid-party providers)에 의해 운영되며, CDN으로 들어가고 나가는 데이터 전송 양에 따라 요금을 내게 된다.
따라서, 자주 사용되지 않는 컨텐츠를 캐싱하는 것은 득이 될 것이 없으므로 CDN에서 빼는 것을 고려한다.

## 2. 적절한 만료 시한 설정
시의성이 중요한(time-sensitive) 컨텐츠의 경우, 만료 시점을 잘 정해야 한다.
너무 길지도 않고 짧지도 않아야 하는데, 너무 길면 컨텐츠의 신선도는 떨어질 것이고, 너무 짧으면 원본 서버에 빈번히 접속하게 되어 좋지 않다.

## 3. CDN 장애에 대한 대처 방안
CDN 자체가 죽었을 경우 웹사이트/애플리케이션이 어떻게 동작해야 하는지 고려해야 한다.
일시적으로 CDN이 응답하지 않을 경우, 해당 문제를 감지하여 원본 서버로부터 직접 컨텐츠를 가져오도록 클라이언트를 구성하는 것이 필요할 수도 있다.

## 4. 컨텐츠 무효화(invalidation) 방법
아직 만료되지 않은 컨텐츠라 하더라도 아래 방법 가운데 하나를 쓰면 CDN에서 제거할 수 있다.
- CDN 서비스 사업자가 제공하는 API를 이용하여 컨텐츠 무효화
- 컨텐츠의 다른 버전을 서비스하도록 오브젝트 버저닝(object versioning)을 이용
  - 컨텐츠의 새로운 버전을 지정하기 위해서는 URL 마지막에 버전 번호를 인자로 주면 된다.
  - 예를 들어, image.png?v=2와 같은 식이다.

# 참고 자료
---
- 알렉스 쉬, 『가상 면접 사례로 배우는 대규모 시스템 설계 기초』, 인사이트(2021), 1장

